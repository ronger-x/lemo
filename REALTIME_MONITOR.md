# 🚀 实时系统监控仪表盘

## 新功能概述

已为 Lemo 工具包添加了全新的**实时系统监控仪表盘**，采用现代化 TUI Grid 布局，提供动态刷新的系统状态信息。

## 主要特性

### 1. 📊 Grid 布局设计

采用左右分栏 + 上中下分割的 Grid 布局（2x3）：

```
┌─────────────────────────────────────────────────────────┐
│            📊 Real-time System Monitor                  │
├──────────────────────────┬──────────────────────────────┤
│                          │                              │
│   🔧 CPU Progress Bar    │   💿 Disk Information       │
│   (动态刷新)              │   (多磁盘，按盘符排序)        │
│                          │                              │
├──────────────────────────┼──────────────────────────────┤
│                          │                              │
│   💾 Memory Progress Bar │   � GPU & Temperature      │
│   (实时使用率)            │   (GPU温度 + 硬件传感器)      │
│                          │                              │
├──────────────────────────┼──────────────────────────────┤
│                          │                              │
│   🌐 Network Traffic     │   ℹ️  System Info           │
│   (接口流量统计)          │   (基本系统信息)             │
│                          │                              │
└──────────────────────────┴──────────────────────────────┘
│            Press Q/Esc/Enter to return                  │
└─────────────────────────────────────────────────────────┘
```

### 2. 🎨 进度条可视化

#### CPU 使用率
- 实时刷新（每 1 秒）
- 彩色进度条：
  - 🟢 绿色：0-50%（正常）
  - 🟡 黄色：50-80%（中等）
  - 🔴 红色：80-100%（高负载）
- 显示 CPU 型号和当前使用率百分比

#### 内存使用率
- 实时刷新（每 1 秒）
- 彩色进度条：
  - 🟢 绿色：0-60%（正常）
  - 🟡 黄色：60-80%（警告）
  - 🔴 红色：80-100%（危险）
- 显示已用/总容量（GB）和使用率百分比

#### 磁盘使用情况
- 显示所有已挂载磁盘
- **按盘符排序**（C:\、D:\、E:\ 等）
- 每个磁盘独立的 ASCII 进度条
- 彩色标识：
  - 🟢 绿色：0-70%
  - 🟡 黄色：70-90%
  - 🔴 红色：90-100%
- 显示已用/总容量（GB）

#### 网络流量统计
- 显示前 3 个活跃网络接口
- 上传/下载流量统计（MB）
- 彩色标识：
  - 🟢 绿色：下载流量
  - 🔵 蓝色：上传流量
- 自动跳过无流量接口

### 3. 🌡️ 温度监控

#### GPU 信息
- ✅ **新增 GPU 温度显示**
- 自动检测显卡温度传感器
- 彩色温度标识：
  - 🟢 绿色：< 60°C（正常）
  - 🟡 黄色：60-80°C（温暖）
  - 🔴 红色：> 80°C（过热）

#### 管理员权限检测
- ✅ **已启用管理员权限请求**：TUI 模式下会自动请求管理员权限
- ⚠️ 无管理员权限时显示友好提示：
  ```
  ⚠️  Administrator privileges required
     for temperature monitoring
  ```

#### 温度显示
- 检测所有可用的硬件传感器
- **优先显示**：GPU、CPU Package、主板温度
- 彩色温度标识：
  - 🟢 绿色：< 60°C（正常）
  - 🟡 黄色：60-80°C（温暖）
  - 🔴 红色：> 80°C（过热）
- 显示传感器名称和实时温度值
- 最多显示 3 个主要传感器（GPU + CPU + 主板）

### 4. 🌐 网络监控（新增！）

- **实时网络流量**：显示所有活跃网络接口
- **智能过滤**：自动跳过无流量接口
- **流量统计**：
  - 下载流量（绿色标识）
  - 上传流量（蓝色标识）
- **接口限制**：最多显示 3 个活跃接口
- **名称截断**：自动截断过长的接口名称

### 5. ⚡ 动态刷新机制

- **刷新频率**：每 1 秒自动更新
- **刷新项目**：
  - CPU 使用率
  - 内存使用率
  - 网络流量统计
  - 磁盘状态（按需刷新）
  - GPU 温度（按需刷新）
  - 硬件温度（按需刷新）
- **非阻塞设计**：使用 `event::poll()` 实现响应式 UI，不影响用户交互

### 6. 📋 系统基本信息

实时显示：
- 操作系统类型
- CPU 架构
- 物理核心数 / 逻辑核心数
- 系统运行时间（天/小时/分钟）

## 使用方法

### 启动 TUI 模式
```powershell
# 以管理员身份运行（推荐，可显示温度）
.\target\release\lemo.exe
```

### 操作步骤
1. 程序启动后，选择 **"📊 Real-time Monitor"** 选项
2. 按 `Enter` 进入实时监控仪表盘
3. 观察动态刷新的系统状态
4. 按 `Q`、`Esc` 或 `Enter` 返回主菜单

### 键盘快捷键
- `↑/↓` 或 `j/k`: 导航菜单
- `Enter`: 执行选中项
- `Q/Esc`: 退出/返回

## 技术实现

### 核心依赖
- **ratatui 0.29**: TUI 框架
  - `Layout`: Grid 布局管理
  - `Gauge`: 进度条组件
  - `Paragraph`: 文本显示
  - `Block`: 边框和标题
- **sysinfo 0.32**: 系统信息采集
  - `System`: CPU、内存、运行时间
  - `Disks`: 磁盘信息
  - `Components`: 硬件温度传感器
- **crossterm 0.28**: 终端控制
  - `event::poll()`: 非阻塞事件轮询

### 代码结构
```rust
main.rs
├── show_realtime_monitor()        // 主循环，处理刷新和事件
├── render_monitor_ui()            // Grid 布局渲染
├── render_cpu_info()              // CPU 进度条
├── render_memory_info()           // 内存进度条
├── render_disk_info()             // 磁盘信息
├── render_temperature_info()      // 温度监控
└── render_system_info()           // 基本信息
```

## 权限说明

### 为什么需要管理员权限？

1. **温度监控**：访问硬件传感器需要提升权限
2. **系统清理**：清理 `C:\Windows\Temp` 等系统目录需要管理员权限
3. **图标缓存修复**：终止 `explorer.exe` 需要管理员权限

### 如何授予权限？

#### 方法 1：右键以管理员身份运行
```powershell
右键 lemo.exe → "以管理员身份运行"
```

#### 方法 2：PowerShell 提升
```powershell
Start-Process .\target\release\lemo.exe -Verb RunAs
```

#### 方法 3：程序自动请求（已实现）
```rust
if !is_admin() {
    println!("Administrator privileges required. Requesting elevation...");
    run_as_admin()?;
    return Ok(());
}
```
程序会自动弹出 UAC 提示，点击"是"即可。

## 性能优化

- ✅ **非阻塞刷新**：使用 `event::poll(100ms)` 避免 CPU 占用过高
- ✅ **按需更新**：仅每秒刷新一次系统信息，减少系统调用
- ✅ **轻量渲染**：TUI 仅在数据变化时重绘界面

## 效果展示

### CPU 进度条示例
```
┌─ 🔧 CPU: Intel(R) Core(TM) i7-9750H ───────┐
│ ████████████████░░░░░░░░  45.3%            │
└─────────────────────────────────────────────┘
```

### 内存进度条示例
```
┌─ 💾 Memory: 12.3 GB / 16.0 GB ─────────────┐
│ ███████████████████░░░░░  76.9%            │
└─────────────────────────────────────────────┘
```

### 磁盘信息示例
```
┌─ 💿 Disks ──────────────────────────────────┐
│ C:\     ████████████████████  89%           │  ← 按盘符排序
│         223.5/250.0 GB                      │
│ D:\     ██████████░░░░░░░░░░  48%           │
│         480.0/1000.0 GB                     │
│ E:\     ███░░░░░░░░░░░░░░░░░  15%           │
│         150.0/1000.0 GB                     │
└─────────────────────────────────────────────┘
```

### 网络流量示例（新增！）
```
┌─ 🌐 Network ────────────────────────────────┐
│ 📡 Ethernet                                 │
│    ↓ 1234.56 MB  ↑ 567.89 MB               │
│ 📡 Wi-Fi                                    │
│    ↓ 89.12 MB    ↑ 45.67 MB                │
└─────────────────────────────────────────────┘
```

### GPU 和温度显示示例（更新！）
```
┌─ 🌡️  GPU & Temperature ────────────────────┐
│ 🎮 GPU: 65.5°C                              │
│                                             │
│ CPU Package       72.0°C                    │
│ Motherboard       45.0°C                    │
│ System            42.0°C                    │
└─────────────────────────────────────────────┘
```

## 故障排除

### 问题 1：温度显示为空或显示权限提示
**原因**：未以管理员身份运行

**解决方案**：
```powershell
# 右键以管理员身份运行
Start-Process .\target\release\lemo.exe -Verb RunAs
```

### 问题 2：TUI 界面显示不正常
**原因**：终端尺寸过小

**解决方案**：
- 调整终端窗口大小至至少 80x24
- 使用全屏模式（`Alt+Enter`）

### 问题 3：程序无法启动
**原因**：缺少依赖或编译问题

**解决方案**：
```powershell
# 重新编译
cargo clean
cargo build --release
```

## 未来计划

- [ ] 添加网络流量监控
- [ ] 添加进程列表查看器
- [ ] 支持历史数据图表（CPU/内存趋势）
- [ ] 添加自定义刷新频率设置
- [ ] 支持导出系统报告

## 版本历史

### v0.1.0 (2025-11-06)
- ✅ 实现 Grid 布局系统监控
- ✅ 添加 CPU/内存/磁盘进度条
- ✅ 添加硬件温度监控
- ✅ 实现动态刷新机制（1秒）
- ✅ 添加管理员权限检测和自动提升

## 贡献者

- **ronger** - 初始实现

---

**Enjoy the real-time system monitoring! 🎉**
